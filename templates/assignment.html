{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

  <h3>{{ assignment.title }}</h3>
  <p class="text-muted">–ö–ª–∞—Å: {{ assignment.classroom_name }}</p>

  {% if assignment.description %}
    <p>{{ assignment.description }}</p>
  {% endif %}

  {% if assignment.attachments %}
  <div class="mt-3">
    <h6>–ü—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏ –≤–∏–∫–ª–∞–¥–∞—á–∞:</h6>
    <ul>
      {% for file in assignment.attachments | fromjson %}
        <li><a href="/uploads/{{ file }}" target="_blank">{{ file }}</a></li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <hr>

{% if user.role == 'student' %}
  {% if my_submission %}
    <h5>‚úÖ –í–∏ –≤–∂–µ –∑–¥–∞–ª–∏ –∑–∞–≤–¥–∞–Ω–Ω—è!</h5>
    <p><strong>–¢–µ–∫—Å—Ç:</strong> {{ my_submission.text_answer }}</p>

    {% if my_submission.attachments %}
      <h6>–í–∞—à—ñ –ø—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏:</h6>
      <ul>
        {% for f in my_submission.attachments | fromjson %}
          <li><a href="/uploads/{{ f }}" target="_blank">{{ f }}</a></li>
        {% endfor %}
      </ul>
    {% endif %}

    <p class="text-muted">–ó–¥–∞–Ω–æ: {{ my_submission.submitted_at }}</p>

    {% if my_submission.grade or my_submission.teacher_comment %}
      <hr>
      <div class="alert alert-info mt-3">
        <h6>üßæ –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –≤–∏–∫–ª–∞–¥–∞—á–µ–º:</h6>
        {% if my_submission.grade %}
          <p><strong>–û—Ü—ñ–Ω–∫–∞:</strong> {{ my_submission.grade }}</p>
        {% endif %}
        {% if my_submission.teacher_comment %}
          <p><strong>–ö–æ–º–µ–Ω—Ç–∞—Ä:</strong> {{ my_submission.teacher_comment }}</p>
        {% endif %}
      </div>
    {% else %}
      <p class="text-muted mt-3">‚è≥ –í–∞—à—É —Ä–æ–±–æ—Ç—É —â–µ –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ.</p>
    {% endif %}

  {% else %}
    <h5>–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å</h5>
    <form method="post" enctype="multipart/form-data">
      <div class="mb-3">
        <label for="text_answer" class="form-label">–¢–µ–∫—Å—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ</label>
        <textarea name="text_answer" id="text_answer" class="form-control" rows="3"></textarea>
      </div>
      <div class="mb-3">
        <label for="submission" class="form-label">–ü—Ä–∏–∫—Ä—ñ–ø–∏—Ç–∏ —Ñ–∞–π–ª–∏</label>
        <input type="file" name="submission" id="submission" multiple class="form-control">
      </div>
      <button type="submit" class="btn btn-success">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
    </form>
  {% endif %}
{% endif %}


{% if user.role == 'teacher' %}
  <h4 class="mt-4">–í—ñ–¥–ø–æ–≤—ñ–¥—ñ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</h4>
  {% if submissions %}
    <table class="table table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>–£—á–µ–Ω—å</th>
          <th>–¢–µ–∫—Å—Ç</th>
          <th>–§–∞–π–ª–∏</th>
          <th>–ß–∞—Å</th>
          <th>–û—Ü—ñ–Ω–∫–∞</th>
          <th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th>
          <th>–î—ñ—è</th>
        </tr>
      </thead>
      <tbody>
        {% for s in submissions %}
        <tr>
          <td>{{ s.student_name }}</td>
          <td style="white-space: pre-wrap;">{{ s.text_answer or '' }}</td>
          <td>
            {% if s.attachments %}
              <ul class="mb-0">
                {% for f in s.attachments | fromjson %}
                  <li><a href="/uploads/{{ f }}" target="_blank">{{ f }}</a></li>
                {% endfor %}
              </ul>
            {% else %}
              ‚Äî
            {% endif %}
          </td>
          <td>{{ s.submitted_at }}</td>

          <td colspan="3">
            <form method="post" class="row g-2">
              <input type="hidden" name="submission_id" value="{{ s.id }}">
              <div class="col-md-3">
                <input type="text" name="grade" class="form-control form-control-sm"
                       value="{{ s.grade or '' }}" placeholder="–û—Ü—ñ–Ω–∫–∞">
              </div>
              <div class="col-md-6">
                <input type="text" name="teacher_comment" class="form-control form-control-sm"
                       value="{{ s.teacher_comment or '' }}" placeholder="–ö–æ–º–µ–Ω—Ç–∞—Ä">
              </div>
              <div class="col-md-3 d-grid">
                <button type="submit" class="btn btn-success btn-sm">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
              </div>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-muted">–©–µ –Ω—ñ—Ö—Ç–æ –Ω–µ –∑–¥–∞–≤ —Ü–µ –∑–∞–≤–¥–∞–Ω–Ω—è.</p>
  {% endif %}
{% endif %}


</div>
{% endblock %}
